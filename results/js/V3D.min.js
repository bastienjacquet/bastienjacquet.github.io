THREE.GeneralIntrinsicCamera=function(a,b,c,d){THREE.Camera.call(this),this.intrinsic=void 0!==a?a.clone():(new THREE.Matrix3).fromArray([1,0,0,0,1,0,.5,.5,1]),this.sensorSize=void 0!==b?b:new Array(1,.8),this.near=void 0!==c?c:.1,this.far=void 0!==d?d:2e3,0!=this.intrinsic.elements[3]&&console.warn("THREE.GeneralIntrinsicCamera: camera matrices with skew factor are unsupported ! Skew will be ignored."),this.updateProjectionMatrix()},THREE.GeneralIntrinsicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.GeneralIntrinsicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeFrustumFromIntrinsic(this.intrinsic,this.sensorSize,this.near,this.far)},THREE.GeneralIntrinsicCamera.prototype.clone=function(){var a=new THREE.GeneralIntrinsicCamera;return THREE.Camera.prototype.clone.call(this,a),a.intrinsic=this.intrinsic,a.sensorSize=this.sensorSize,a.near=this.near,a.far=this.far,a},THREE.SfMCamera=function(a,b){THREE.Object3D.call(this),this.view=void 0!==b?b:new THREE.SfMView,this.camera=new THREE.GeneralIntrinsicCamera(this.view.intrinsic,this.view.size,THREE.SfMCamera.near,THREE.SfMCamera.far),this.showCamera=!0,this.add(this.camera);var c=new THREE.Vector3,d=new THREE.Quaternion,e=new THREE.Vector3;camera_pose=(new THREE.Matrix4).getInverse(a),camera_pose.decompose(c,d,e);var f=c;this.quaternion.copy(d),this.position.copy(f),this.updateMatrix(!0),this.updateMatrixWorld(),this.showCamera&&(this.cameraHelper=new THREE.SfMCameraHelper(this),this.camera.add(this.cameraHelper))},THREE.SfMCamera.near=-20,THREE.SfMCamera.far=10*THREE.SfMCamera.near,THREE.SfMCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.SfMCamera.prototype.toString=function(){var a=(new THREE.Matrix4).getInverse(this.matrix);return"{ View: "+this.view+", \n"+"extrinsic:"+a+", \n"+"center:["+this.camera.position.toArray()+"]"+" }"},THREE.V3DLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager,this.data={},this.isLoaded={},this.queueDepGraph=[],this.logParseInfo=!1,this.manager.onProgress=function(a,b,c){console.log(a,b,c)};var b=this;this.manager.onLoad=function(){void 0!==b.onAllLoaded&&b.onAllLoaded()},this.scene=new THREE.Scene},THREE.V3DLoader.prototype={constructor:THREE.V3DLoader,async_callback_gate:function(){for(var a in this.queueDepGraph){var b=this.queueDepGraph[a];if(!b.isExecuted){var c=!0;for(var d in b.dependsOn)c=c&&this.isLoaded[b.dependsOn[d]];if(c){this.isLoaded[b.name]=b.isExecuted=!0,args=[],b.data&&args.push(b.data);for(var d in b.dependsOn)args.push(this.data[b.dependsOn[d]]);this.data[b.name]=b.func.apply(void 0,args),this.async_callback_gate()}}}},asyncLoadedCallbackWrapper:function(a,b,c){this.isLoaded[a]=!1;var d=this;return function(e){d.queueDepGraph.push({name:a,func:b,data:e,dependsOn:c}),d.async_callback_gate.call(d)}},loadFileNames:function(a,b){var c=this;b&&this.queueDepGraph.push({name:"FileNamesCB",func:b,dependsOn:["Views"]});var d=new THREE.XHRLoader(this.manager);d.setCrossOrigin(this.crossOrigin),d.setResponseType("text"),d.load(a,this.asyncLoadedCallbackWrapper("FileNames",c.parseFilenames))},loadCalibDb:function(a,b){var c=this;b&&this.queueDepGraph.push({name:"CalibCB",func:b,dependsOn:["Views"]}),this.queueDepGraph.push({name:"Views",func:this.mergeFilenameCalibDb,dependsOn:["FileNames","Calibs"]});var d=new THREE.XHRLoader(c.manager);d.setCrossOrigin(this.crossOrigin),d.setResponseType("text"),d.load(a,this.asyncLoadedCallbackWrapper("Calibs",c.parseCalibDb))},loadExtrinsics:function(a,b){var c=this,d=a instanceof Array?a[0]:a,e=a instanceof Array&&a.length>1?a[1]:"main";b=b||this.defaultExtrinsicLoaderCallbackCreator();var f=[];void 0!==this.isLoaded.Calibs&&f.push("Views");var g=new THREE.XHRLoader(c.manager);g.setCrossOrigin(this.crossOrigin),g.setResponseType("text");var h=function(a,d){return b(c.parseExtrinsics(a,d),e)};g.load(d,this.asyncLoadedCallbackWrapper("Extrinsics",h,f))},loadMesh:function(a,b){var c=this;_url=a instanceof Array?a[0]:a,_color=a instanceof Array&&a.length>1?a[1]:16777215,_parentObjectName=a instanceof Array&&a.length>2?a[2]:"main",b=b||this.defaultMeshGeometryCallbackCreator(_color,_parentObjectName),this.manager.itemStart(_url);var d=new THREE.CTMLoader,e=function(a){b(a),c.manager.itemEnd(_url)};d.load(_url,e,{useWorker:!0})},loadRelativeObservations:function(a,b,c){var d=this;c=c||this.defaultRelativeObservationsLoaderCallbackCreator();var e=new THREE.XHRLoader(d.manager);e.setCrossOrigin(this.crossOrigin),e.setResponseType("text");var f=function(a){return c(d.parseRelativeObservations(a,b))};e.load(a,this.asyncLoadedCallbackWrapper("RelativeObs",f))},parseFilenames:function(a){for(var b=[],c=a.split("\n"),d=0;d<c.length;d++){var e=c[d].trim();0!=e.length&&(b.push({viewId:b.length,imageFilename:e}),this.logParseInfo&&console.log("THREE.V3DLoader.parseFilenames: View id #"+b.slice(-1)[0].viewId+" : "+e))}return b},parseCalibDb:function(a){for(var b=[],c=a.split("\n"),d=parseInt(c[0]),e=/(\s*[\d|\.|\+|\-|e]+)(\s+[\d|\.|\+|\-|e]+)(\s+[\d|\.|\+|\-|e]+)(\s+[\d|\.|\+|\-|e]+)(\s+[\d|\.|\+|\-|e]+)(\s+[\d|\.|\+|\-|e]+)(\s+[\d|\.|\+|\-|e]+)(\s+[\d|\.|\+|\-|e]+)(\s+[\d|\.|\+|\-|e]+)(\s+[\d|\.|\+|\-|e]+)(\s+[\d|\.|\+|\-|e]+)/,f=0;d>f;f++){var g=new THREE.Matrix3,h=new Array,i=c[f+1].trim(),j=e.exec(i);(null===j||12!=j.length)&&console.warn("THREE.V3DLoader.CalibDb : error parsing line '"+i+"'"),g.elements[0]=parseFloat(j[1]),g.elements[3]=parseFloat(j[2]),g.elements[6]=parseFloat(j[3]),g.elements[4]=parseFloat(j[4]),g.elements[7]=parseFloat(j[5]),g.elements[1]=0,g.elements[2]=0,g.elements[5]=0,g.elements[8]=1,h[0]=parseFloat(j[10]),h[1]=parseFloat(j[11]),b.push({viewId:b.length,intrinsic:g,size:h}),this.logParseInfo&&console.log("THREE.V3DLoader.parseCalibDb: Calib of View #"+f+": size "+h[0]+"x"+h[1]+", intrinsic "+g.toArray())}return b},mergeFilenameCalibDb:function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d].viewId;void 0===c[e]&&(c[e]=new THREE.SfMView(e)),c[e].imageFilename=a[d].imageFilename,c[e].setTbFilename()}for(var d=0;d<b.length;d++){var e=b[d].viewId;void 0===c[e]&&(c[e]=new THREE.SfMView(e)),c[e].intrinsic=b[d].intrinsic,c[e].size=b[d].size}return c},parseExtrinsics:function(a,b){for(var c=[],d=a.split("\n"),e=parseInt(d[0]),f=/(\s*[\d|\.|\+|\-|e]+)(\s+[\d|\.|\+|\-|e]+)(\s+[\d|\.|\+|\-|e]+)(\s+[\d|\.|\+|\-|e]+)/,g=0;e>g;g++){for(var h=1+4*g,i=parseInt(d[h]),j=(new THREE.Matrix4).identity(),k=0;3>k;k++){var l=d[h+k+1].trim(),m=f.exec(l);(null===m||5!=m.length)&&console.warn("THREE.V3DLoader : error parsing line '"+l+"'");for(var n=0;4>n;n++)j.elements[4*n+k]=parseFloat(m[1+n])}c.push(new THREE.SfMCamera(j,b?b[i]:new THREE.SfMView)),this.logParseInfo&&console.log("THREE.V3DLoader.parseExtrinsics: Camera "+g+" using view #"+i+": "+b[i]+", extrinsic:["+j.toArray()+"]")}return c},parseMatrix:function(a,b,c,d,e,f){function g(a){return new RegExp("(\\s*[\\d|\\.|\\+|\\-|e]+)"+"(\\s+[\\d|\\.|\\+|\\-|e]+)".repeat(a-1))}String.prototype.repeat=function(a){return new Array(a+1).join(this)},e=e||a,f=f||b,elements=[],elements[e*f-1]=0,lineRegExp=g(b);for(var h=0;a>h;h++){var i=c[d+h].trim(),j=lineRegExp.exec(i);(null===j||j.length-1!=b)&&console.warn("THREE.parseMatrix : error parsing line '"+i+"' : should have "+b+" int, here : "+j.length+lineRegExp+j);for(var k=0;b>k;k++)elements[k*e+h]=parseFloat(j[1+k])}return e!=f&&console.warn("THREE.V3DLoader.parseMatrix: Non square matrix "+e+" x "+f),4==e?(new THREE.Matrix4).fromArray(elements):3==e?(new THREE.Matrix3).fromArray(elements):void 0},parseRelativeObservations:function(a,b){for(var c=[],d=a.split(/\n+/),e=Math.floor(d.length/4),f=/(\s*[\d|\.|\+|\-|e]+)(\s+[\d|\.|\+|\-|e]+)(\s+[\d|\.|\+|\-|e]+)(\s+[\d|\.|\+|\-|e]+)/,g=/(\s*[\d|\.|\+|\-|e]+)(\s+[\d|\.|\+|\-|e]+)/,h=0;e>h;h++){for(var i=4*h,j=g.exec(d[i]),k=parseInt(j[1]),l=parseInt(j[2]),m=(new THREE.Matrix4).identity(),n=0;3>n;n++){var o=d[i+n+1].trim(),j=f.exec(o);(null===j||5!=j.length)&&console.warn("THREE.V3DLoader : error parsing line '"+o+"'");for(var p=0;4>p;p++)m.elements[4*p+n]=parseFloat(j[1+p])}c.push({ref:b[k],obj:b[l],matrix:m}),this.logParseInfo&&console.log("THREE.V3DLoader.parseRelativeObservations: "+b[k]+"  -> "+b[l]+": ["+m.toArray()+"]")}return c},defaultExtrinsicLoaderCallbackCreator:function(){var a=this;return function(b,c){var c=c||"main",d=a.scene.getObjectByName(c,!0);void 0===d&&(d=new THREE.Object3D,d.name=c,a.scene.add(d));for(var e=0;e<b.length;e++)d.add(b[e]),this.logParseInfo&&console.log("THREE.V3DLoader.defaultExtrinsicLoader: camera "+e+": "+b[e])}},defaultMeshGeometryCallbackCreator:function(a,b){var c=this;return function(d){b=b||"main";var e=c.scene.getObjectByName(b,!0);void 0===e&&(e=new THREE.Object3D,e.name=b,c.scene.add(e));var f=new THREE.MeshPhongMaterial({ambient:a,color:a,specular:3355443,shininess:10,shading:THREE.SmoothShading,transparent:!1,opacity:1}),g=new THREE.Mesh(d,f);g.castShadow=!0,g.receiveShadow=!0,g.name=b+"|Mesh",e.add(g)}},defaultRelativeObservationsLoaderCallbackCreator:function(){var a=this;return function(b){for(var c in b){var d=b[c].ref,e=a.scene.getObjectByName(d,!0),f=b[c].obj,g=a.scene.getObjectByName(f,!0);e.add(g),g.obsMatrix||(g.obsMatrix=[]),g.obsMatrix.push({matrix:b[c].matrix,viewId:b[c].viewId})}}}},THREE.V3DLoader.createLoadScene=function(){var a={scene:new THREE.Scene,camera:new THREE.PerspectiveCamera(65,window.innerWidth/window.innerHeight,1,1e3)};a.camera.position.z=100,a.scene.add(a.camera);var b,c,d,e,f=200,g=200;d=new THREE.MeshLambertMaterial({color:16777215}),c=new THREE.BoxGeometry(5,5,5);for(var h=0;f>h;h++)d=new THREE.MeshLambertMaterial({color:16777215*Math.random()}),b=new THREE.Mesh(c,d),b.position.x=(Math.random()-.5)*g,b.position.y=(Math.random()-.5)*g,b.position.z=(Math.random()-.5)*g,b.rotation.x=6*Math.random(),b.rotation.y=6*Math.random(),b.rotation.z=6*Math.random(),b.matrixAutoUpdate=!1,b.updateMatrix(),a.scene.add(b);return timeStep=.05,a.updateScene=function(){a.scene.traverse(function(a){a instanceof THREE.Mesh&&(a.speed||(a.speed=new THREE.Vector3),a.speed.add(new THREE.Vector3((Math.random()-.5)*g*timeStep,(Math.random()-.5)*g*timeStep,(Math.random()-.5)*g*timeStep)),a.translateOnAxis(a.speed,timeStep),a.rotateX(Math.random()*timeStep),a.rotateY(Math.random()*timeStep),a.rotateZ(Math.random()*timeStep),a.updateMatrix())})},a.scene.matrixAutoUpdate=!1,e=new THREE.PointLight(16777215),a.scene.add(e),e=new THREE.DirectionalLight(1118481),e.position.x=1,a.scene.add(e),a},THREE.V3DLoader.initStandardLoadingPage=function(){function b(){requestAnimationFrame(b),controls&&controls.update(),a.updateScene(),render(),stats.update()}container=document.createElement("div"),document.body.appendChild(container);var a=THREE.V3DLoader.createLoadScene();camera=camera_fly=a.camera,scene=a.scene,renderer=new THREE.WebGLRenderer({antialias:!0}),renderer.setSize(window.innerWidth,window.innerHeight),renderer.domElement.style.position="relative",container.appendChild(renderer.domElement),renderer.gammaInput=!0,renderer.gammaOutput=!0,renderer.shadowMapEnabled=!0,stats=new Stats,stats.domElement.style.position="absolute",stats.domElement.style.bottom="0px",stats.domElement.style.right="0px",stats.domElement.style.zIndex=100,container.appendChild(stats.domElement),window.addEventListener("resize",onWindowResize,!1),controls=new THREE.TrackballControls(camera_fly,container),controls.rotateSpeed=1,controls.zoomSpeed=5,controls.panSpeed=1,controls.noZoom=!1,controls.noPan=!1,controls.staticMoving=!0,controls.dynamicDampingFactor=.5,controls.keys=[65,83,68],controls.addEventListener("change",render),b()},THREE.V3DLoader.initDefaultGUI=function(){gui=new dat.GUI;var a=gui.addFolder("Viewer");fov=a.add(camera_fly,"fov",10,180).step(2).name("Cam Vert FoV"),fov.onChange(function(){camera_fly.updateProjectionMatrix(),render()}),gui_array=["  None  "],gui_cameraArray={},scene.traverse(function(a){if(a instanceof THREE.SfMCamera){var b="SFM #"+a.view.viewId+" | "+a.parent.name;gui_array.push(b)}}),a.add(params,"camera_selected",gui_array).name("SfM Camera").onChange(function(a){var b;if(null!==(b=/SFM #(\d+)/.exec(a))){var c=parseInt(b[1]);camera=cameras_sfm[c].camera,render()}else camera_fly.copyPosition(camera),camera=camera_fly,render()}),a.add(spotLight,"intensity").min(0).max(1).step(.05).name("Spotlight"),a.add(params,"showSfMCameras").name("Show Cameras").onChange(showSfMCameras);var b=0;scene.traverse(function(a){if(a instanceof THREE.Mesh&&a.name){params.meshes[b]={color:a.material.color.getHex(),mesh:a,side:"front"};var c=gui.addFolder("Mesh "+b+': "'+a.parent.name+'"'),d=c.addColor(params.meshes[b],"color").name("Color");if(d.idMesh=b,d.onChange(function(){for(var b=0;b<params.meshes.length;++b)params.meshes[b].color=(""+params.meshes[b].color).replace("#","0x"),params.meshes[b].mesh.material.color.setHex(params.meshes[b].color),params.meshes[b].mesh.material.ambient.setHex(params.meshes[b].color);render()}),c.add(params.meshes[b].mesh.material,"opacity").name("Opacity").min(0).max(1).step(.5).listen().onChange(function(){for(var b=0;b<params.meshes.length;++b)params.meshes[b].mesh.material.visible=0!=params.meshes[b].mesh.material.opacity,params.meshes[b].mesh.material.transparent=1!=params.meshes[b].mesh.material.opacity,params.meshes[b].mesh.material.needsUpdate=!0;render()}),a.parent.obsMatrix){var f={};for(var g in a.parent.obsMatrix)f["#"+g+(a.parent.obsMatrix[g].viewId||"")]=g;a.parent.curObs=0,c.add(a.parent,"curObs",f).name("Observed Pose").onChange(function(b){a.parent.obsMatrix[b].matrix.decompose(a.parent.position,a.parent.quaternion,a.parent.scale)})}b++}})},THREE.Matrix4.prototype.toString=function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14],n=a[3],o=a[7],p=a[11],q=a[15];return"\n["+b+","+c+","+d+","+e+";\n"+f+","+g+","+h+","+i+";\n"+j+","+k+","+l+","+m+";\n"+n+","+o+","+p+","+q+"]"},THREE.Matrix4.prototype.setRotationFromMatrix3=function(a){var b=this.elements,c=a.elements;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[4]=c[3],b[5]=c[4],b[6]=c[5],b[8]=c[6],b[9]=c[7],b[10]=c[8],this},THREE.Matrix4.prototype.makeFrustumFromIntrinsic=function(a,b,c,d){(new THREE.Matrix3).fromArray([b[0]/2,0,0,0,b[1]/2,0,b[0]/2,b[1]/2,1]);var f=(new THREE.Matrix3).getInverse((new THREE.Matrix4).identity().setRotationFromMatrix3(a)),g=new THREE.Vector3(0,0,1).applyMatrix3(f),h=new THREE.Vector3(b[0],b[1],1).applyMatrix3(f),i=c*Math.max(h.y,g.y),j=c*Math.min(h.y,g.y),k=c*Math.min(h.x,g.x),l=c*Math.max(h.x,g.x);return this.makeFrustum(k,l,j,i,c,d)},THREE.SfMCameraHelper=function(a){function o(a,b,c){p(a,c),p(b,c)}function p(a,c){b.vertices.push(new THREE.Vector3),b.colors.push(new THREE.Color(c)),void 0===i[a]&&(i[a]=[]),i[a].push(b.vertices.length-1)}var f,g,b=new THREE.Geometry,c=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),d=!0,e=new THREE.Geometry,i={},j=16755200,k=16711680,l=43775,m=16777215,n=3355443;if(o("n1","n2",j),o("n2","n4",j),o("n4","n3",j),o("n3","n1",j),o("f1","f2",j),o("f2","f4",j),o("f4","f3",j),o("f3","f1",j),o("n1","f1",j),o("n2","f2",j),o("n3","f3",j),o("n4","f4",j),o("p","n1",k),o("p","n2",k),o("p","n3",k),o("p","n4",k),o("u1","u2",l),o("u2","u3",l),o("u3","u1",l),o("c","t",m),o("p","c",n),o("cn1","cn2",n),o("cn3","cn4",n),o("cf1","cf2",n),o("cf3","cf4",n),THREE.Object3D.call(this),this.wireframeMesh=new THREE.Line(b,c,THREE.LinePieces),this.add(this.wireframeMesh),this.imageMesh=void 0,d){for(var q=0;4>q;q++)e.vertices.push(new THREE.Vector3);e.faces.push(new THREE.Face3(1,0,3)),e.faces.push(new THREE.Face3(0,2,3));var r=[new THREE.Vector2(0,0),new THREE.Vector2(1,0),new THREE.Vector2(1,1),new THREE.Vector2(0,1)];e.faceVertexUvs[0]=[],e.faceVertexUvs[0][0]=[r[0],r[1],r[3]],e.faceVertexUvs[0][1]=[r[1],r[2],r[3]];var f=new THREE.ImageUtils.loadTexture(a.view.thumbnailFilename),g=new THREE.MeshLambertMaterial({map:f,emissive:16777215,side:THREE.DoubleSide});this.imageMesh=new THREE.Mesh(e,g),this.add(this.imageMesh)}this.sfMCamera=a,this.matrixWorld=a.camera.matrixWorld,this.matrixAutoUpdate=!1,this.useImageTexture=d,this.pointMap=i,this.sensorRect=[-.5,.5,-.4,.4],this.sensorRect=[-1,1,-1,1],this.showProjectionCube=!1,this.update()},THREE.SfMCameraHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.SfMCameraHelper.prototype.updateSensorRect=function(){var a=(new THREE.Matrix3).getInverse((new THREE.Matrix4).identity().setRotationFromMatrix3(this.sfMCamera.view.intrinsic)),b=new THREE.Vector3(0,0,1).applyMatrix3(a),c=new THREE.Vector3(this.sfMCamera.view.size[0],this.sfMCamera.view.size[1],1).applyMatrix3(a),d=Math.max(c.y,b.y),e=Math.min(c.y,b.y),f=Math.min(c.x,b.x),g=Math.max(c.x,b.x);this.sensorRect=[f,g,e,d]},THREE.SfMCameraHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Camera,c=new THREE.Projector;return function(){function l(e,f,g,h){a.set(f,g,h),c.unprojectVector(a,b);var i=d.pointMap[e];if(void 0!==i)for(var j=0,k=i.length;k>j;j++)d.wireframeMesh.geometry.vertices[i[j]].copy(a)}var d=this,e=d.sensorRect[0],f=d.sensorRect[1],g=d.sensorRect[2],h=d.sensorRect[3],i=(e+f)/2,j=(h+g)/2,k=this.sfMCamera.showProjectionCube?1:-1;b.projectionMatrix.copy(this.sfMCamera.camera.projectionMatrix),l("c",i,j,-1),l("t",i,j,k),l("n1",e,g,-1),l("n2",f,g,-1),l("n3",e,h,-1),l("n4",f,h,-1),l("f1",e,g,k),l("f2",f,g,k),l("f3",e,h,k),l("f4",f,h,k),l("u1",.7*f,1.1*h,-1),l("u2",.7*e,1.1*h,-1),l("u3",0,2*h,-1),l("cf1",e,0,k),l("cf2",f,0,k),l("cf3",0,g,k),l("cf4",0,h,k),l("cn1",e,0,-1),l("cn2",f,0,-1),l("cn3",0,g,-1),l("cn4",0,h,-1),this.wireframeMesh.geometry.verticesNeedUpdate=!0,d.useImageTexture&&(d.imageMesh.geometry.vertices[0].copy(d.wireframeMesh.geometry.vertices[d.pointMap.n1[0]]),d.imageMesh.geometry.vertices[1].copy(d.wireframeMesh.geometry.vertices[d.pointMap.n2[0]]),d.imageMesh.geometry.vertices[2].copy(d.wireframeMesh.geometry.vertices[d.pointMap.n3[0]]),d.imageMesh.geometry.vertices[3].copy(d.wireframeMesh.geometry.vertices[d.pointMap.n4[0]]),this.imageMesh.geometry.verticesNeedUpdate=!0)}}(),THREE.SfMView=function(a,b,c,d,e){this.viewId=void 0!==a?a:THREE.SfMView.maxViewId+1,this.intrinsic=void 0!==b?b:new THREE.Matrix3,this.size=void 0===c?new Array(1,.8):new Array(c),this.imageFilename=void 0!==d?d:"",this.thumbnailFilename=void 0!==e?e:"mini/"+this.imageFilename,THREE.SfMView.maxViewId=Math.max(THREE.SfMView.maxViewId,this.viewId)},THREE.SfMView.maxViewId=-1,THREE.SfMView.prototype={constructor:THREE.SfMView,width:function(){return this.size[0]},height:function(){return this.size[1]},vertical_fov:function(){return THREE.Math.radToDeg(2*Math.atan(this.height()/2/this.intrinsic.elements[4]))},setTbFilename:function(a){this.thumbnailFilename=void 0!==a?a:"mini/"+this.imageFilename},toString:function(){return"{ id:#"+this.viewId+", "+"intrinsic:["+this.intrinsic.toArray()+"]"+", "+"size:["+this.size+"]"+", "+'image:"'+this.imageFilename+'"'+", "+'thumbnail:"'+this.thumbnailFilename+'"'+" }"}};